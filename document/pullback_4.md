<!--------------------------------------------------------------------------------- Description --->
# Poolback 4x
```
Ichimoku Dual Cloud Switch Backtest
```
```
استراتژی پولبک ۴ برابر  
مبتنی بر دو ابر ایچیموکو – تریگر سویچ کومو در تنظیمات استاندارد + فیلتر روند در تنظیمات بزرگ‌تر
```
```
 جهت‌گیری اصلی: دنباله‌رو روند بزرگ (ابر Ichi2) + پولبک کوتاه‌مدت (سویچ ابر Ichi1)
```
```
واحد محاسبه pnl: تفاوت قیمت خام (بدون در نظر گرفتن حجم معامله، اسپرد، کمیسیون یا اسلیپیج)
```

<!--------------------------------------------------------------------------------- Parameters --->
<br><br>

## Parameters

<!----------------name--->
#### name
```
این پارامتر برای تعیین نام استراتژی می‌باشد
```
```python
name='poolback_4x'
```
<!----------------time_frame--->
#### time_frame
```
تایم‌فریم
```
```python
time_frame='1min'
```
<!----------------region--->
#### region
```
برای تعیین نوع تایم می‌باشد
```
```python
region='UTC'
```
<!----------------time_from--->
#### time_from
```
زمان شروع مجاز معامله
```
```python
time_from='00:00:00'
```
<!----------------time_to--->
#### time_to
```
زمان پایان مجاز معامله 
```
```
پوزیشن جدید باز نمیشود. اگر پوزیشنی باز بود بسته نمی شود ( مدیریت میشود)
```
```python
time_to='21:00:00'
```
<!----------------max_order--->
#### max_order
```
حداکثر پوزیشن همزمان
```
```python
max_order=1
```
<!----------------period--->
#### period
```
میانگین ھای و لول های مختلف کندل
```
```
دوره های اجزای ایچیموکو 1:(9,26,78)
دوره های اجزای ایچیموکو 2:(36,104,234) 
```
```python
period = {
    "t1": 9,
    "k1": 26,
    "sb1": 78,
    "t2": 36,
    "k2": 104,
    "sb2": 234
}
```
<!----------------sa--->
#### sa
```
میانگین ھای و لول های مختلف کندل
```
```
محاسبه sa1 وsa2
میانگین t2 , k2
میانگن t1 , k1
```
```python
sa1 = (t1 + k1)/2
sa2 = (t2 + k2)/2
```



<!--------------------------------------------------------------------------------- Actions --->
<br><br>

## Actions

<!----------------data--->
#### Step 01 | data 
```
1: از زمان شروع استراتژی گرفتن دیتای 234 کندل گذشته
2: محاسبه ی نقاط ایچیموکو 1 و 2
t1: میانگین های و لوی 9 دوره ی گذشته
k1: میانگین های و لوی 26 دوره ی گذشته
sb1: میانگین های و لوی 78 دوره ی گذشته
t2: میانگین های و لوی 36 دوره ی گذشته
k2: میانگین های و لوی 104 دوره ی گذشته
sb2:میانگین های و لوی 234 دوره ی گذشته
```
```
action_1: gereftane dataye  tamame item haye count
action_2: mohasebeye average bar ase high va low 
action_3 | average[10] = {"count_t_1":9 , "count_k_1":26 , "count_sb_1":78 , "count_t_2":36 , "count_k_2":104 , "count_sb_2":234 }
```

<!----------------average--->
#### Step 02 | average 
```
: محاسبه ی sa1 و sa2
sa1: میانگین t1 و k1
sa2: میانگین t2 و k2
```
```
action_1: sa1[10]:average = (count_t_1 + count_k_1)/2
action_2: sa2[10]:average = (count_t_2 + count_k_2)/2
```

<!----------------candel_close--->
#### Step 03 | candel_close 
```
کلوز کندل 1 دقیقه | شروع دقیقه جدید 00:00:00
```
```
action_1: candel_close | price shoro minute
```

<!----------------switch_up_1--->
#### Step 04 | switch_up_1
```
سویچ صعودی کوموی ایچی 1
کلوز قیمت بالای اسپن آ و اسپن بی و
بررسی sa1 و sb1 در کندل لایو و کندل گذشته. وقتی در کندل لایو اسپن آ بالای اسپن بی قرار گرفته
و در کندل قبل از لایو اسپن آ زیر اسپن بی قرار داشته است. 
اگر در کندل قبل از لایو اسپن آ برابر با اسپن بی بود به کندل قبل از آن یا - 2 می رویم اگر باز هم
برابر بود به - 3 و - 4 و... باید به کندلی برسیم که اسپن آ زیر اسپن بی باشد
```
``` 
#sa1 | sb1 
action_1: loop 10 ta 1
action_1: if sa1[1] > average(count["count_sb_1"])
action_1: 
          if sa1[i-1] < average(count["count_sb_1"])
            javab
          else == 
            sa1[i-2] < average(count["count_sb_1"])
```

<!----------------switch_down_1--->
#### Step 05 | switch_down_1
```
سویچ نزولی کوموی ایچی 1
کلوز قیمت زیر اسپن آ و اسپن بی
بررسی sa1 و sb1 در کندل لایو و کندل گذشته. وقتی در کندل لایو اسپن آ زیر اسپن بی قرار گرفته
و در کندل قبل از لایو اسپن آ بالای اسپن بی قرار داشته است. 
اگر در کندل قبل از لایو اسپن آ برابر با اسپن بی بود به کندل قبل از آن یا - 2 می رویم اگر باز هم
برابر بود به - 3 و - 4 و... باید به کندلی برسیم که اسپن آ بالای اسپن بی باشد
```
```python
#sa1 | sb1 
action_1: loop 10 ta 1
action_1: if sa1[1] < average(count["count_sb_1"])
action_1: 
          if sa1[i-1] > average(count["count_sb_1"])
            javab
          else == 
            sa1[i-2] > average(count["count_sb_1"])
```

<!----------------tk_up--->
#### Step 06 | tk_up
```
تنکن و کیجن صعودی ایچی 2
وقتی تنکن بالای کیجن قرار دارد
```
```
action_1: if average(count["count_t_2"]) > average(count["count_k_2"]) 
```

<!----------------tk_down--->
#### Step 07 | tk_down 
```
تنکن و کیجن نزولی ایچی 2
وقتی تنکن زیر کیجن قرار دارد
```
```
action_1: if average(count["count_t_2"]) < average(count["count_k_2"]) 
```

<!----------------switch_up_2--->
#### Step 08 | kumo_up_2
```
کوموی صعودی ایچی2
وقتی sa2 بالای sb2 قرار دارد
```
```
#sa2 | sb2
action_1: if average(count["count_sa_2"]) > average(count["count_sb_2"])
```

<!----------------switch_down_2--->
#### Step 09 | kumo_down_2
```
کوموی نزولی ایچی2
وقتی sa2 بالای sb2 قرار دارد
```
```
#sa2 | sb2
action_1: if average(count["count_sa_2"]) < average(count["count_sb_2"])
```

<!----------------enter--->
#### Step 10 | enter
```
ورود
وقتی در ایچی دو کومو صعودی و تنکن کیجن هم صعودی
و در ایچی 1 سویچ نزولی کومو اتفاق افتاد
با کلوز کندل وارد خرید میشویم
وقتی در ایچی دو کومو نزولی و تنکن کیجن هم نزولی
و در ایچی 1 سویچ صعودی کومو اتفاق افتاد
با کلوز کندل وارد فروش میشویم
```
```
action_1: if kumo_up_2 ** tk_up_2 && switch_down_1
action_2: buy
action_3: if kumo_down_2 ** tk_down_2 && switch_up_1
action_4: sell
```
